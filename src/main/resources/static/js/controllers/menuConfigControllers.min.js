"use strict";app.controller("menuConfigModuleController",["$rootScope","$scope","$http","$stateParams","$state",function(a,b,e,d,c){b.select_branch=function(f){c.go("menuConfig.edit",f)};console.log("menuConfigModuleController")}]);app.controller("menuConfigFormController",["$rootScope","$scope","$http","$stateParams","entity",function(a,c,f,e,b){c.id=e.id;c.ownRoles=[];c.allRoles=[];c.menu={};c.entities=[];c.selectEntity=null;c.entityWorkflows=null;c.selectWorkflow=null;c.parentMenu=null;c.entityIsSelected=false;var d=/[A-Z]/;angular.forEach(a.allEntitiesInfo,function(h,g){if(d.exec(g)===null){c.entities.push({label:g})}});c.changeEntity=function(g){if(g){c.entityIsSelected=true;b.getList("rest/"+g.label+"Workflows").then(function(h){c.entityWorkflows=h._embeddedItems;if(c.menu._links){angular.forEach(c.entityWorkflows,function(j,i){if(c.menu.workflowId===j.id){c.selectWorkflow=j}})}})}};if(c.id){b.getDetail("rest/menus/"+c.id,["parent","visibleRoles"]).then(function(g){c.menu=g;if(JSON.stringify(c.menu.parent)!=="{}"&&angular.isObject(c.menu.parent)){c.parentMenu=b.getSelectedMyOwn(a.menus,c.menu.parent)}angular.forEach(c.entities,function(i,h){if(c.menu.entityKey===i.label){c.selectEntity=i;c.changeEntity(c.selectEntity)}});c.ownRoles=c.menu.visibleRoles._embeddedItems;c.getAllRoles(c.ownRoles)})}c.getAllRoles=function(g){b.getList("rest/roles?size=10000").then(function(h){c.allRoles=h._embeddedItems;angular.forEach(c.allRoles,function(j,i){j.isSelected=false;angular.forEach(g,function(l,k){if(l.id===j.id){j.isSelected=true}})})})};c.save=function(){delete c.menu.visibleRoles;c.menu.parent=c.parentMenu?"rest/menus/"+c.parentMenu.id:null;c.menu.level=c.menu.level?Number(c.menu.level):null;c.menu.entityKey=c.selectEntity?c.selectEntity.label:null;c.menu.workflowId=c.selectWorkflow?c.selectWorkflow.id:null;if(c.menu._links){f({url:c.menu._links.self.href,method:"PATCH",data:c.menu}).success(function(g){a.toasterSuccess("成功！","修改成功！");location.reload(true)})}else{f.post("rest/menus",c.menu).success(function(g){f({method:"PATCH",url:"rest/menus/"+g.id+"/visibleRoles",data:"rest/roles/1",headers:{"Content-Type":"text/uri-list"}}).success(function(h){a.toasterSuccess("成功！","新建成功！");location.reload(true)})})}};c.changeMenuRole=function(g){if(g.isSelected){f({method:"PATCH",url:c.menu._links.visibleRoles.href,data:g._links.self.href,headers:{"Content-Type":"text/uri-list"}}).success(function(h){a.toasterSuccess("成功！","关联成功！")})}else{f({method:"DELETE",url:c.menu._links.visibleRoles.href+"/"+g.id}).success(function(h){a.toasterInfo("成功！","已取消关联！")})}}}]);