<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的申请</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="stylesheet" href="../../css/weui.css">
    <link rel="stylesheet" href="../../css/weui2.css">
    <link rel="stylesheet" href="../../css/jquery.mloading.css">
    <link rel="stylesheet" href="../../css/animate.css">
    <link rel="stylesheet" href="../../css/global.css">
    <link rel="stylesheet" href="../../css/loading.css">
    <style>
        .weui_uploader_input_wrp {
            margin: 0 6px;
            float: none;
            display: inline-block;
            width: 65px;
            height: 65px;
            border: 1px #d9d9d9 dashed;
        }
        .weui_icon_success:before {
            font-size: 16px;
            color: #09bb07;
        }
        .weui_cells{
            font-size: 16px;
        }

        .weui_tab_nav .weui_nav_red.bg_red {
            border-color: #169BD5;!important;
            color: #fff;
            background: #169BD5;!important;
        }
        .weui_navbar_item{

        }
        .weui_navbar_item.tab-green{
            background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
            border-bottom: 3px solid #169BD5;
            color: #169BD5;
        }
        .weui_tab_nav .weui_nav_red {
            display: block;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            width: 100%;
            height: 30px;
            padding: 0;
            font-size: 14px;
            line-height: 31px;
            text-align: center;
            border: 1px solid #169BD5;
            border-width: 1px 1px 1px 0;
            color: #ef4f4f;
            white-space: nowrap;
            background: #fdfdfd;
        }
        .weui_tab_nav .weui_nav_red{
            color: #169BD5;!important;
        }
        .weui_navbar{
            background: #fff;
        }
        .btn{
            width: 100%;
            height: 40px;
            background: #169BD5;
            border-radius: 20px;
            display: inline-block;
            text-align: center;
            line-height: 40px;
            color: white;
            font-size: 16px;
        }
        .btn:active{
            background: #CCCCCC;
            color: white;
        }
        .now_card{
            display: block;
            background: #fff;
            margin-top: 15px;
            border: 1px solid #e6e5e5;
            border-radius: 10px;
            font-size: 14px;
        }

        .now_card span{
            margin-left: 5px;
        }
        .now_card > div{
            padding: 10px 15px;
        }
        .now_card_title_whk{
            padding: 0 12px;
            background: #ffc425;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 1px;
        }
        .now_card_title_wjq{
            padding: 0 12px;
            background: #14c7a7;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 1px;
        }
        .now_card_title_yq{
            padding: 0 12px;
            background: #f96c70;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 1px;
        }
        .now_card_title_yjq{
            padding: 0 12px;
            background: #ccc;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-top: 1px;
        }
        .now_card_content{
            border-top: 1px solid #e6e5e5;
            padding: 15px;
        }
        .margin-top-5{
            margin-top: 5px;
        }
        .timeline-item-tail{
            background: #169BD5;
        }
        .timeline-item-head{
            background: #169BD5;
            height: 15px;
            left: -2px;
            top: 0px;
            width: 15px;
            border: 3px solid #99ccff;
        }
        .time_success{
            color:#0D0D0D;
        }
        .timeline-item-content > p{
            color:#B2B2B2;
        }
        .timeline h4 {
            font-size: 14px;
            font-weight: bold;
        }
        .timeline-item-content {
            padding: 0 0 1.5rem 1.6rem;
        }
        .timeline-item-tail_huise{
            background: #CCCCCC;
        }
        .bkBtn{
            position: fixed;
            bottom:0;
            background:#169BD5;
            text-align: center;
            width: 100%;
            height: 40px;
            color:#fff;
            line-height: 40px;
            z-index: 100;
            cursor:pointer;
        }
        .bkBtn:active{
            background: #ccc;
            color: white;
        }
        .imgBtn{
            cursor: pointer;
        }
        .delBtn{
            position: absolute;
            top: -8px;
            right: -2px;
            font-size: 20px;
            color: #E64340;
            width:20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
        }
    </style>
</head>
<body>
<div id='stateExamine'>
    <div style="height: 100%;">
    
        <div style="padding: 15px;background: #fff">
            <div class="clearfix">
                <p style="float: left;color: #B2B2B2;">项目名称</p><p style="float: right">随借随还</p>
            </div>
            <div class="clearfix margin-top-5">
                <p style="float: left;color: #B2B2B2;">申请金额</p><p id='examineMoney' style="float: right">130000.00元</p>
            </div>
            <div class="clearfix margin-top-5">
                <p style="float: left;color: #B2B2B2;">申请时间</p><p id='examineDate' style="float: right">2017/09/08</p>
            </div>
            <div class="clearfix margin-top-5">
                <p style="float: left;color: #B2B2B2;">保证金</p><p id="examineBond" style="float: right">200.00元</p>
            </div>
        </div>
        <div style="padding: 15px 15px 5px 15px; color: #B2B2B2;font-size: 15px;border-bottom: 1px solid #e6e6e6;">
            借款进度
        </div>
        <div style="min-height: calc(100% - 235px);background: #fff;width: 100%">
            <div style="padding: 30px 0 30px 15%;">
                <div class="timeline">
                    <ul>
                        <li class="timeline-item">
                            <div class="timeline-item-head">
                                <i class="weui_icon weui_icon_success_no_circle timeline-item-checked hide"></i>
                            </div>
                            <div class="timeline-item-tail"></div>
                            <div class="timeline-item-content">
                                <h4 class="time_success">提交申请</h4>
                                <p style="height: 25px;"></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div  class="timeline-item-head">
                                <i class="weui_icon weui_icon_success_no_circle timeline-item-checked hide" ></i>
                            </div> <div class="timeline-item-tail" ></div>
                            <div class="timeline-item-content">
                                <h4 class="time_success">审核中</h4>
                                <p style="height: 25px;"></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div  class="timeline-item-head">
                                <i class="weui_icon weui_icon_success_no_circle timeline-item-checked hide" ></i>
                            </div><div class="timeline-item-tail"  style="background: #ccc"></div>
                            <div class="timeline-item-content clearfix">
                                <div class="left">
                                    <h4 id='isAdopt' style="color:#FC2321;">初步审核未通过</h4>
                                </div>
                                <div id='isAdopt_ziliao' class="left" style="margin-left: 30px; cursor: pointer; ">
                                    <p style="color:#169BD5;padding:2px 10px;border-radius:5px;border: 1px solid #169BD5">补充资料</p>
                                </div>
                                <p id='comment' style='clear:both'></p>
                            </div>
                        </li>
                        <li class="timeline-item">
                            <div  class="timeline-item-head"  style="border: 3px solid #ccc;background: #fff">
                                <i class="weui_icon weui_icon_success_no_circle timeline-item-checked hide" ></i>
                            </div>
                            <div class="timeline-item-content clearfix">
                                <div class="left">
                                    <h4 id='bdsh'>终审通过</h4>
                                </div>
                                <p id='bdcomment' style='clear:both'></p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div>
            <a id='examineBtn' class="bkBtn">确定</a>
        </div>
    </div>
</div>
</body>
<script src="../../js/config.js"></script>
<script src="../../js/jquery-3.2.1.js"></script>
<script src="../../js/zepto.min.js"></script>
<script src="../../js/jquery.mloading.js"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="../../js/loading.js"></script>
<script src="../../js/picker.js"></script>
<script src="../../js/picker-city.js"></script>
<script>
    //jsSDK
    var JsUrl =window.location.href;
    $.ajax({
        type: "get",
        url: "/wechat/wlqz/getCofigure",
        data:{'JsUrl':JsUrl},
        dataType: "json",
        success: function(res){
            console.log(res)
            wx.config({
                debug: false,
                appId:res.appId ,
                timestamp: res.timestamp,
                nonceStr: res.nonceStr,
                signature: res.signature,
                jsApiList: [
                    'chooseImage',
                    'uploadImage',
                    'previewImage',
                    'getLocation'
                    // 所有要调用的 API 都要加到这个列表中
                ]
            });
            wx.ready(function () {
                wx.getLocation({
                    type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                    success: function (res) {
                        var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                        var speed = res.speed; // 速度，以米/每秒计
                        var accuracy = res.accuracy; // 位置精度
                        console.log(latitude);
                        console.log(longitude);
                        //设置AJAX的全局默认选项
                        $.ajaxSetup( {

                            headers: { // 默认添加请求头
                                app_code:"WULIUQIANZHUANG",
                                client:"wechat",
                                latitude:latitude,
                                longitude:longitude
                            }
                        } );

                    }
                });



            });
            wx.error(function(res){

                // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
            });


        }
    })

    if(window.location.search){
        var href = window.location.href.split('?')[1];
        var splitId = href.split('&')[0];
        var splitProduct= href.split('&')[1];
        window.id = splitId.split('=')[1];    //产品实体ID
        window.product= splitProduct.split('=')[1];  //哪种产品

        //随借随还
        if(window.product == 1){
            //填充信息
            $.ajax({
                type: 'GET',
                url: '/rest/orderwdsjshes/'+window.id ,
                data: {} ,
                headers: {
                    app_code:"WULIUQIANZHUANG",
                    client:"wechat"
                },
                success: function (res) {
                    var examineMoney = (res.applyAmount).toFixed(2) + '元';
                    $('#examineMoney').text(examineMoney);

                    var examineDate = res.createdAt;
                    examineDate = examineDate.split('T')[0];
                    $('#examineDate').text(examineDate);
                    var examineBond = res.applyAmount * 0.05;
                    examineBond = examineBond.toFixed(2) +'元';
                    $('#examineBond').text(examineBond);  //保证金
                    $('#comment').text(res.comment);
                } ,
                dataType: 'json'
            });


            $.ajax({
                type: 'GET',
                url: '/rest/orderwdsjshes/'+window.id+'/state' ,
                data: {} ,
                headers: {
                    app_code:"WULIUQIANZHUANG",
                    client:"wechat"
                },
                success: function (res) {
                    if(res.ActionStatus == 'FAIL'){
                        alert(res.ErrorInfo)
                    }else{
                        console.log(res)

                        //物流钱庄未通过
                        if(res.stateCode == 'DENIED'){
                            $('#examineBtn').text('去补全');
                            $('#comment').show();
                            $('#examineBtn').click(function(){
                                var link = 'profileCreated.html?id='+id+'&product=1';
                                window.location.href=link;
                            })
                        }
                        //物流钱庄通过
                        else if(res.stateCode == 'ADOPT'){
                        	$('#comment').hide();
                            $('#examineBtn').text('下一步');
                            $('#isAdopt').text('初步审核通过')
                            $('#isAdopt').css('color','#666');
                            $('#isAdopt_ziliao').hide();


                            $('#examineBtn').click(function(){
                                //填充信息
                                $.ajax({
                                    type: 'GET',
                                    url: '/rest/orderwdsjshes/'+window.id ,
                                    data: {} ,
                                    headers: {
                                        app_code:"WULIUQIANZHUANG",
                                        client:"wechat"
                                    },
                                    success: function (res) {
                                        var amount = res.applyAmount;
                                        var mobile = res.applyMobile;
                                        var name = res.realName;
                                        var idcar = res.applyIdentityNo;
                                        var fileUrl ="http://files.xiaojinpingtai.com/"+res.zipName;
                                        var toUrl=window.config.link+'/bdjf/html5/basicInformation.html?mobile='+mobile+'&name='+name+'&idcar='+idcar+'&zcCode=1004&zcName='+window.config.zcName+'&ptproductId='+window.config.ptproductId+'&productName='+window.config.productName+'&amount='+amount+'&fileUrl='+fileUrl;
                                        window.location.href=toUrl;
                                    } ,
                                    dataType: 'json'
                                });

                            })
                        }

                    }
                } ,
                dataType: 'json'
            });
        }
    }


</script>
</html>